<!DOCTYPE HTML>
<HTML>
<HEAD>
    <link href="bower/css/bootstrap.min.css" rel="stylesheet">
    <link href="bower/css/cornerstone.css" rel="stylesheet">

    <script src="bower/js/jquery.min.js"></script>
    <script src="bower/js/bootstrap.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.16/angular.min.js"></script>
    <script src="config.js"></script>   
    <script src="util.js"></script>
  
<style>
table {
    border-collapse: collapse;
    width: 30%;
}
table, th, td {
    border: 1px solid black;
}
td, th {
    padding: 5px;
}
th {
    background-color: #81BEF7
}
tr:nth-child(odd) {
    background: #DEDFE0;
}
</style>

    <script>
    /*    
    $(document).ready(function() {
        console.log("Running jQuery!");
        $(".repType").click(function(e) {
            e.preventDefault();
            var repVal = $(this).text();
            console.log("Click event recorded.");
            $('#typeDisplay').text("Selected Report Type is " + repVal);
            $('#typeDisplay').css("color","red");
        });

    }); */
    </script>

</HEAD>
<BODY>


<div class="container" ng-app="reportSelect" ng-controller="rsCtrl">
    <div class="row">
        <div class="jumbotron">
            <h2>FHIR/DICOMWeb Dev Project</h2>
            Radiology EMR client based on FHIR and DICOMweb REST API's.  Select a patient's reports based on type
        </div>
    </div>
    <div id="main">
        <div class="row">
            <form id="searchForm" class="form-inline" role="form">
            <button type="submit" class="btn btn-primary" ng-click="fetch()">Search</button>
            <div class="form-group">
                <label for="inputName">Name: </label>
                <input type="text" class="form-control" id="inputName" placeholder="" value="" ng-model="name">
            </div>
            <div class="form-group">
                <div class="dropdown">
                    <select name="reportType" ng-model="reportType" ng-options="r.code as r.display for r in repCat">
                        <option value="">-- Select ReportType --</option>
                    </select>
                </div>
            </div>
            </form>
        </div>
        <div>
        <p>
        <div class="row">
            <div class="row" ng-show="reports"><i>Total results: {{ totalResults }}</i>
            </div>
            <table class="table">
                <thead>
                <tr>
                    <th>Name</th>
                    <th>Date</th>
                    <th>Acc#</th>
                    <th>Text</th>
                    <th>Type</th>
                </tr>
                </thead>
                <tbody id="reportListTable">
                <tr ng-repeat="x in reports | filter:name">
                <td>{{ x.content.subject.reference.split("/")[1] }}
                <td>{{ x.content.issued }}</td>
                <td>{{ x.content.identifier.value }}</td>
                <td>{{ x.content.name.text }}</td>
                <td>{{ totalResults }}</td>
                </tbody>
            </table>
     
        </div>
</div>

<script>

var app = angular.module('reportSelect',[]);

app.controller('rsCtrl', function($scope,$http) {
    
    $scope.repCat = 
        [
            {"code":"AU","display":"Audiology"},
            {"code":"BG","display":"Blood Gases"},
            {"code":"BLB","display":"Blood Bank"},
            {"code":"CH","display":"Chemistry"},
            {"code":"CP","display":"Cytopathology"},
            {"code":"CT","display":"CAT Scan"},
            {"code":"CTH","display":"Cardiac Catheterization"},
            {"code":"CUS","display":"Cardiac Ultrasound"},
            {"code":"EC","display":"Electrocardiac (e.g., EKG,  EEC, Holter)"},
            {"code":"EN","display":"Electroneuro (EEG, EMG,EP,PSG)"},
            {"code":"HM","display":"Hematology"},
            {"code":"ICU","display":"Bedside ICU Monitoring"},
            {"code":"IMG","display":"Diagnostic Imaging"},
            {"code":"IMM","display":"Immunology"},
            {"code":"LAB","display":"Laboratory"},
            {"code":"MB","display":"Microbiology"},
            {"code":"MCB","display":"Mycobacteriology"},
            {"code":"MYC","display":"Mycology"},
            {"code":"NMR","display":"Nuclear Magnetic Resonance"},
            {"code":"NMS","display":"Nuclear Medicine Scan"},
            {"code":"NRS","display":"Nursing Service Measures"},
            {"code":"OSL","display":"Outside Lab"},
            {"code":"OT","display":"Occupational Therapy"},
            {"code":"OTH","display":"Other"},{"code":"OUS","display":"OB Ultrasound"},
            {"code":"PAR","display":"Parasitology"},
            {"code":"PAT","display":"Pathology (gross & histopath, not surgical)"},
            {"code":"PF","display":"Pulmonary Function"},
            {"code":"PHR","display":"Pharmacy"},
            {"code":"PHY","display":"Physician (Hx. Dx, admission note, etc.)"},
            {"code":"PT","display":"Physical Therapy"},
            {"code":"RAD","display":"Radiology"},
            {"code":"RC","display":"Respiratory Care (therapy)"},
            {"code":"RT","display":"Radiation Therapy"},
            {"code":"RUS","display":"Radiology Ultrasound"},
            {"code":"RX","display":"Radiograph"},
            {"code":"SP","display":"Surgical Pathology"},
            {"code":"SR","display":"Serology"},
            {"code":"TX","display":"Toxicology"},
            {"code":"URN","display":"Urinalysis"},
            {"code":"VR","display":"Virology"},
            {"code":"VUS","display":"Vascular Ultrasound"},
            {"code":"XRC","display":"Cineradiograph"}
        ]
    
    
    $scope.fetch = function() {
        var url = "http://fhir.hackathon.siim.org/fhir/DiagnosticReport";
        var urlparams = {};
        if ($scope.name) {
            urlparams.subject = "Patient/" + $scope.name;
        }
        urlparams.service = $scope.reportType;

        var req = {
            params:urlparams,
            headers: {
                "Accept" : "application/json"
            }
        }
        
        $http.get(url,req).success(function(data) {
            $scope.totalResults = data.totalResults;
            $scope.reports = data.entry;
            console.log(data);
        });
    }         
});

</script>

</BODY>
</HTML>        
                